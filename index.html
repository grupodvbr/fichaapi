<!DOCTYPE html>
<html lang="pt-BR">
<head>
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#000000">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Cardápio Premium">

<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Cardápio Digital • Premium</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{
  --bg:#0b0b0c; --card:#111113; --text:#ffffff; --muted:#a1a1aa;
  --gold:#d4af37; --gold-soft:rgba(212,175,55,.25);
  --border:#1f1f22; --radius:18px; --shadow:0 20px 60px rgba(0,0,0,.6);
}
*{box-sizing:border-box}
body{
  margin:0; font-family:Inter,system-ui; color:#fff;
  background:linear-gradient(180deg,#000 0%, #0b0b0c 40%, #000 100%);
  overflow-y:scroll;
}
body::-webkit-scrollbar{width:0;height:0}
.top{position:sticky;top:0;z-index:10;padding:14px;background:linear-gradient(180deg,rgba(0,0,0,.9),rgba(0,0,0,.6) 60%,transparent);backdrop-filter:blur(8px)}
.search{width:100%;height:48px;border-radius:999px;border:1px solid var(--border);background:#0f0f12;color:#fff;padding:0 18px;font-weight:700}
.cats{display:flex;gap:10px;margin-top:10px;overflow-x:auto}
.cats::-webkit-scrollbar{height:0}
.cat{padding:10px 14px;border-radius:999px;border:1px solid var(--border);background:#0f0f12;color:#fff;font-weight:800;font-size:12px;cursor:pointer}
.cat.active,.cat:hover{border-color:var(--gold);color:var(--gold)}
.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;padding:12px 12px 80px}
.card{background:#0f0f12;border:1px solid var(--border);border-radius:18px;overflow:hidden;cursor:pointer}
.thumb{width:100%;aspect-ratio:1/1;object-fit:cover}
.body{padding:12px}
.name{font-weight:900;font-size:14px}
.desc{font-size:12px;color:#9ca3af;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.price{margin-top:6px;font-weight:900;color:var(--gold)}
.modal{
  position:fixed; inset:0; background:rgba(0,0,0,.9);
  display:none; align-items:flex-end; z-index:100;
}
.modal.open{display:flex}
.modal-box{
  width:100%; max-width:720px; height:92vh;
  background:#000; border-radius:26px 26px 0 0; overflow:hidden;
  animation:up .25s ease;
}
@keyframes up{from{transform:translateY(30px);opacity:.7}to{transform:none;opacity:1}}
.modal-img{
  width:100%; height:55vh; object-fit:contain; background:#000;
}
.modal-overlay{
  position:absolute; inset:0;
  background:linear-gradient(180deg,transparent 40%, rgba(0,0,0,.9) 85%);
}
.modal-body{position:relative; padding:18px; margin-top:-60px}
.modal-title{font-size:24px;font-weight:900}
.modal-desc{margin-top:8px;color:#cbd5f5;line-height:1.45}
.modal-price{margin-top:12px;font-size:24px;font-weight:900;color:var(--gold)}
.close{position:absolute;right:16px;top:10px;font-weight:900;font-size:22px;cursor:pointer}
@media(min-width:700px){.grid{grid-template-columns:repeat(3,1fr)}}
@media(min-width:1024px){.grid{grid-template-columns:repeat(4,1fr)}}
html, body {
  overscroll-behavior: none;
  touch-action: pan-y;
  -webkit-tap-highlight-color: transparent;
}
.subcats{
  margin-top:8px;
  padding-bottom:4px;
  opacity:.9;
}
.cat.group{
  border-style:dashed;
  opacity:.9;
}
.cat.back{
  background:transparent;
  border-color:transparent;
  color:var(--muted);
}

</style>
</head>

<body>

<div class="top">
  <input id="search" class="search" placeholder="Buscar no cardápio..." />
  <div id="cats" class="cats"></div>
  <div id="subcats" class="cats subcats" style="display:none"></div>
</div>


<div id="grid" class="grid"></div>

<div id="modal" class="modal" onclick="closeModal()">
  <div class="modal-box" onclick="event.stopPropagation()">
    <span class="close" onclick="closeModal()">✕</span>
    <div style="position:relative">
      <img id="mImg" class="modal-img" />
      <div class="modal-overlay"></div>
    </div>
    <div class="modal-body">
      <div id="mName" class="modal-title"></div>
      <div id="mDesc" class="modal-desc"></div>
      <div id="mPrice" class="modal-price"></div>
    </div>
  </div>
</div>

<script>
/* Seu JS original (sem mudanças de lógica) */
const sb = supabase.createClient("https://dxkszikemntfusfyrzos.supabase.co","sb_publishable_NNFvdfSXgOdGGVcSbphbjQ_brC3_9ed");
const GROUPS = [
  { key: "", label: "TODOS" },

  { key: "BEBIDAS", label: "BEBIDAS", sub: [
    { key: "DRINK", label: "DRINKS" },
    { key: "VINHO", label: "VINHOS" },
    { key: "ESPUMANTE", label: "ESPUMANTES" },
    { key: "WHISKY", label: "WHISKY" },
    { key: "GIN", label: "GIN" },
    { key: "VODKA", label: "VODKA" },
    { key: "TEQUILA", label: "TEQUILA" },
    { key: "LICOR", label: "LICOR" },
    { key: "CAMPARI", label: "CAMPARI" }
  ]},

  { key: "COMIDAS", label: "COMIDAS", sub: [
    { key: "SUSHI", label: "SUSHI" }
  ]}
];

let page=0, PAGE_SIZE=10, catAtiva="", termo="", carregando=false, fimLista=false;
let grupoAberto = null;

const idsCarregados=new Set();
const grid=document.getElementById("grid");
const cats=document.getElementById("cats");
const subcats=document.getElementById("subcats");

const moeda=v=>"R$ "+Number(v||0).toLocaleString("pt-BR",{minimumFractionDigits:2});

function renderCats(){
  cats.innerHTML = GROUPS.map(g => {
    if(!g.sub){
      return `<button class="cat ${catAtiva===''?'active':''}" onclick="setCat('')">TODOS</button>`;
    }
    return `<button class="cat group ${grupoAberto===g.key?'active':''}" onclick="openGroup('${g.key}')">${g.label}</button>`;
  }).join("");

  if(!grupoAberto){
    subcats.style.display = "none";
    subcats.innerHTML = "";
  }
}

function openGroup(k){
  grupoAberto = grupoAberto === k ? null : k;
  const group = GROUPS.find(g => g.key === grupoAberto);
  if(!group){ subcats.style.display="none"; return; }

  subcats.style.display = "flex";
  subcats.innerHTML = `
    <button class="cat back" onclick="closeGroup()">◀ Voltar</button>
    ${group.sub.map(s => `
      <button class="cat ${s.key===catAtiva?'active':''}" onclick="setCat('${s.key}')">${s.label}</button>
    `).join("")}
  `;
  renderCats();
}

function closeGroup(){
  grupoAberto = null;
  subcats.style.display = "none";
  subcats.innerHTML = "";
  renderCats();
}

function setCat(k){
  catAtiva = k;
  page = 0;
  fimLista = false;
  idsCarregados.clear();
  grid.innerHTML = "";
  renderCats();
  loadMore();
}

function openModal(p){mImg.src=p.foto_url||"";mName.textContent=p.nome;mDesc.textContent=p.descricao||"";mPrice.textContent=moeda(p.preco_venda);modal.classList.add("open");}
function closeModal(){modal.classList.remove("open");}

async function loadMore(){
  if(carregando||fimLista)return;carregando=true;
  let q=sb.from("buffet").select("id,nome,descricao,preco_venda,foto_url,tipo,ativo").eq("ativo",true).order("created_at",{ascending:false}).range(page*PAGE_SIZE,page*PAGE_SIZE+PAGE_SIZE-1);
  if(catAtiva)q=q.eq("tipo",catAtiva); if(termo)q=q.ilike("nome",`%${termo}%`);
  const {data,error}=await q; carregando=false; if(error)return console.error(error);
  if(!data||!data.length){fimLista=true;return;}
  data.forEach(p=>{ if(idsCarregados.has(p.id))return; idsCarregados.add(p.id);
    const d=document.createElement("div"); d.className="card"; d.onclick=()=>openModal(p);
    d.innerHTML=`<img class="thumb" src="${p.foto_url||""}"><div class="body"><div class="name">${p.nome}</div><div class="desc">${p.descricao||""}</div><div class="price">${moeda(p.preco_venda)}</div></div>`;
    grid.appendChild(d);
  });
  page++;
}
window.addEventListener("scroll",()=>{ if((innerHeight+scrollY)>=document.body.offsetHeight-600) loadMore();});
search.oninput=()=>{ termo=search.value.trim(); page=0; fimLista=false; idsCarregados.clear(); grid.innerHTML=""; loadMore(); };
renderCats(); loadMore();
</script>

</body>
</html>
