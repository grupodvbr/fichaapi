<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>M√≠dias de Promo√ß√£o ‚Ä¢ Admin</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{
  --bg:#0b0b0c; --card:#0f0f12; --text:#fff; --muted:#9ca3af;
  --gold:#d4af37; --border:#1f1f22; --radius:16px;
}
*{box-sizing:border-box}
body{margin:0;background:#000;color:#fff;font-family:Inter}
.header{position:sticky;top:0;padding:14px 18px;background:#000;border-bottom:1px solid var(--border)}
.header h1{margin:0;font-size:18px;font-weight:900}
.container{max-width:1100px;margin:0 auto;padding:16px;display:grid;gap:16px}

.form{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:18px;
  padding:16px;
  display:grid;
  gap:12px;
}
.form h2{margin:0 0 8px;font-size:14px;letter-spacing:.4px;color:var(--gold)}

.row{display:grid;grid-template-columns:1fr 120px;gap:10px}
label{font-size:12px;color:var(--muted)}
input,select,button{
  height:46px;border-radius:12px;border:1px solid var(--border);
  background:#0b0b0c;color:#fff;padding:0 12px
}
button.primary{border-color:var(--gold);color:var(--gold);font-weight:800;cursor:pointer}

.days{display:flex;gap:8px;flex-wrap:wrap}
.day{
  padding:8px 12px;border:1px solid var(--border);border-radius:999px;
  font-size:12px;cursor:pointer;color:#fff
}
.day.active{border-color:var(--gold);color:var(--gold)}

.preview{
  height:160px;border-radius:14px;border:1px dashed var(--border);
  display:grid;place-items:center;overflow:hidden;background:#000
}
.preview img,.preview video{width:100%;height:100%;object-fit:cover}

.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px}
.card{background:#0f0f12;border:1px solid var(--border);border-radius:16px;overflow:hidden}
.card img,.card video{width:100%;aspect-ratio:1/1;object-fit:cover}
.card .meta{display:flex;justify-content:space-between;align-items:center;padding:10px}
.badge{font-size:10px;border:1px solid var(--border);padding:4px 8px;border-radius:999px}
.badge.on{border-color:var(--gold);color:var(--gold)}
.actions{display:flex;gap:6px}
.actions button{padding:6px 10px;font-size:12px}
.danger{border-color:#dc2626;color:#dc2626}
</style>
</head>
<body>

<div class="header"><h1>üì∫ M√≠dias de Promo√ß√£o</h1></div>

<div class="container">

  <div class="form">
    <h2>NOVA PROMO√á√ÉO</h2>

    <label>Arquivo (imagem ou v√≠deo)</label>
    <input id="file" type="file" accept="image/*,video/*">

    <div class="row">
      <div>
        <label>Tipo</label>
        <select id="tipo">
          <option value="IMG">Imagem</option>
          <option value="VIDEO">V√≠deo</option>
        </select>
      </div>
      <div>
        <label>Hor√°rio</label>
        <input id="hora_inicio" type="time" value="00:00">
        <input id="hora_fim" type="time" value="23:59">
      </div>
    </div>

    <label>Dias da semana</label>
    <div class="days" id="dias">
      <div class="day" data-v="1">Seg</div>
      <div class="day" data-v="2">Ter</div>
      <div class="day" data-v="3">Qua</div>
      <div class="day" data-v="4">Qui</div>
      <div class="day" data-v="5">Sex</div>
      <div class="day" data-v="6">S√°b</div>
      <div class="day" data-v="7">Dom</div>
    </div>

    <div class="preview" id="preview">Preview</div>

    <button class="primary" onclick="addPromo()">üì§ Upload & Salvar</button>
  </div>

  <div class="grid" id="grid"></div>

</div>

<script>
const sb = supabase.createClient("https://dxkszikemntfusfyrzos.supabase.co","sb_publishable_NNFvdfSXgOdGGVcSbphbjQ_brC3_9ed");
const fileInput = document.getElementById("file");
const tipoInput = document.getElementById("tipo");
const horaInicioInput = document.getElementById("hora_inicio");
const horaFimInput = document.getElementById("hora_fim");
const preview = document.getElementById("preview");
const grid = document.getElementById("grid");

let diasSel = [];

document.querySelectorAll(".day").forEach(d=>{
  d.onclick = ()=>{
    d.classList.toggle("active");
    const v = Number(d.dataset.v);
    diasSel.includes(v) ? diasSel = diasSel.filter(x=>x!==v) : diasSel.push(v);
  };
});

fileInput.onchange = () => {
  const f = fileInput.files[0];
  if(!f) return;
  preview.innerHTML = f.type.startsWith("video")
    ? `<video src="${URL.createObjectURL(f)}" autoplay muted loop></video>`
    : `<img src="${URL.createObjectURL(f)}">`;
};

async function load(){
  const { data } = await sb.from("promocoes").select("*").order("created_at",{ascending:false});
  grid.innerHTML = (data||[]).map(p=>`
    <div class="card">
      ${p.tipo==="VIDEO" ? `<video src="${p.url}" muted autoplay loop></video>` : `<img src="${p.url}">`}
      <div class="meta">
        <span class="badge ${p.ativo?'on':''}">${p.tipo} ‚Ä¢ ${p.ativo?'ON':'OFF'}</span>
        <div class="actions">
          <button onclick="toggle('${p.id}',${p.ativo})">${p.ativo?'Off':'On'}</button>
          <button class="danger" onclick="delPromo('${p.id}','${p.url}')">Excluir</button>
        </div>
      </div>
    </div>
  `).join("");
}

async function addPromo(){
  const f = fileInput.files[0];
  if(!f) return alert("Selecione um arquivo");
  if(!diasSel.length) return alert("Selecione ao menos um dia");

  const ext = f.name.split(".").pop();
  const path = `promocoes/${Date.now()}_${Math.random().toString(36).slice(2)}.${ext}`;
  await sb.storage.from("promocoes").upload(path, f);

  const { data } = sb.storage.from("promocoes").getPublicUrl(path);

  await sb.from("promocoes").insert({
    url: data.publicUrl,
    tipo: tipoInput.value,
    dias_semana: diasSel,
    hora_inicio: horaInicioInput.value,
    hora_fim: horaFimInput.value,
    ativo:true
  });

  fileInput.value = "";
  preview.innerHTML = "Preview";
  diasSel = [];
  document.querySelectorAll(".day").forEach(d=>d.classList.remove("active"));
  load();
}

async function toggle(id, ativo){
  await sb.from("promocoes").update({ativo:!ativo}).eq("id",id);
  load();
}

async function delPromo(id, url){
  if(!confirm("Excluir m√≠dia?")) return;
  const path = url.split("/storage/v1/object/public/promocoes/")[1];
  if(path) await sb.storage.from("promocoes").remove([path]);
  await sb.from("promocoes").delete().eq("id",id);
  load();
}

load();
</script>
</body>
</html>
