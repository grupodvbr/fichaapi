<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Cardápio Digital • Premium</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{
  --bg:#0b0b0c;
  --card:#111113;
  --text:#ffffff;
  --muted:#a1a1aa;
  --gold:#d4af37;
  --gold-soft:rgba(212,175,55,.25);
  --border:#1f1f22;
  --radius:18px;
  --shadow:0 20px 60px rgba(0,0,0,.6);
}

/* Reset */
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:linear-gradient(180deg,#000 0%, #0b0b0c 40%, #000 100%);
  color:var(--text);
  -webkit-font-smoothing:antialiased;
  overflow-y:scroll;
}
body::-webkit-scrollbar{width:0;height:0}
body{scrollbar-width:none}

/* Topo */
.top{
  position:sticky;
  top:0;
  z-index:10;
  background:linear-gradient(180deg, rgba(0,0,0,.9), rgba(0,0,0,.6) 60%, transparent);
  backdrop-filter: blur(8px);
  padding:14px 14px 6px;
}

/* Busca */
.search{
  width:100%;
  height:48px;
  border-radius:999px;
  border:1px solid var(--border);
  background:#0f0f12;
  color:#fff;
  padding:0 18px;
  font-weight:700;
  outline:none;
  box-shadow:inset 0 0 0 1px rgba(255,255,255,.02);
}
.search::placeholder{color:#777}

/* Categorias */
.cats{
  display:flex;
  gap:10px;
  margin-top:10px;
  overflow-x:auto;
  padding-bottom:8px;
}
.cats::-webkit-scrollbar{height:0}

.cat{
  flex:0 0 auto;
  padding:10px 14px;
  border-radius:999px;
  border:1px solid var(--border);
  background:#0f0f12;
  color:#fff;
  font-weight:800;
  font-size:12px;
  letter-spacing:.04em;
  cursor:pointer;
  transition:.15s ease;
}
.cat.active,
.cat:hover{
  border-color:var(--gold);
  color:var(--gold);
  box-shadow:0 0 0 1px var(--gold-soft), 0 8px 24px rgba(212,175,55,.25);
}

/* Grid */
.grid{
  display:grid;
  grid-template-columns:repeat(2, 1fr);
  gap:12px;
  padding:12px 12px 80px;
}

/* Card */
.card{
  background:linear-gradient(180deg,#0f0f12,#0a0a0c);
  border:1px solid var(--border);
  border-radius:18px;
  overflow:hidden;
  box-shadow:var(--shadow);
  transition:.18s ease;
  cursor:pointer;
}
.card:active{transform:scale(.98)}

.thumb{
  width:100%;
  aspect-ratio:1/1;
  object-fit:cover;
  background:#000;
}

.body{
  padding:12px;
}

.name{
  font-weight:900;
  letter-spacing:.02em;
  font-size:14px;
  margin:0 0 6px;
}

.desc{
  font-size:12px;
  color:#9ca3af;
  line-height:1.35;
  display:-webkit-box;
  -webkit-line-clamp:2;
  -webkit-box-orient:vertical;
  overflow:hidden;
  min-height:2.7em;
}

.price{
  margin-top:8px;
  font-weight:900;
  color:var(--gold);
  font-size:15px;
}

/* Modal */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.8);
  backdrop-filter:blur(6px);
  display:none;
  align-items:flex-end;
  justify-content:center;
  z-index:100;
}
.modal.open{display:flex}

.modal-box{
  width:100%;
  max-width:720px;
  background:linear-gradient(180deg,#0b0b0c,#000);
  border-radius:22px 22px 0 0;
  overflow:hidden;
  border:1px solid var(--border);
}

.modal-img{
  width:100%;
  height:260px;
  object-fit:cover;
}

.modal-body{
  padding:18px;
}

.modal-title{
  font-size:22px;
  font-weight:900;
  letter-spacing:.02em;
}

.modal-desc{
  margin-top:8px;
  color:#cbd5f5;
  line-height:1.45;
}

.modal-price{
  margin-top:12px;
  font-size:22px;
  font-weight:900;
  color:var(--gold);
}

.close{
  position:absolute;
  right:16px;
  top:10px;
  font-size:22px;
  font-weight:900;
  color:#fff;
  cursor:pointer;
}

/* Tablet */
@media(min-width:700px){
  .grid{grid-template-columns:repeat(3,1fr)}
}
@media(min-width:1024px){
  .grid{grid-template-columns:repeat(4,1fr)}
}
</style>
</head>

<body>

<div class="top">
  <input id="search" class="search" placeholder="Buscar no cardápio..." />
  <div id="cats" class="cats"></div>
</div>

<div id="grid" class="grid"></div>

<div id="modal" class="modal" onclick="closeModal()">
  <div class="modal-box" onclick="event.stopPropagation()">
    <span class="close" onclick="closeModal()">✕</span>
    <img id="mImg" class="modal-img" />
    <div class="modal-body">
      <div id="mName" class="modal-title"></div>
      <div id="mDesc" class="modal-desc"></div>
      <div id="mPrice" class="modal-price"></div>
    </div>
  </div>
</div>

<script>
const sb = supabase.createClient(
  "https://dxkszikemntfusfyrzos.supabase.co",
  "sb_publishable_NNFvdfSXgOdGGVcSbphbjQ_brC3_9ed"
);

const CATS = [
  { key:"", label:"TODOS" },
  { key:"PRATO PRINCIPAL", label:"PRATO PRINCIPAL" },
  { key:"ENTRADA", label:"ENTRADA" },
  { key:"SOBREMESA", label:"SOBREMESA" },
  { key:"DRINK", label:"DRINK" },
  { key:"SUSHI", label:"SUSHI" },
  { key:"ACOMPANHAMENTO", label:"ACOMPANHAMENTO" }
];

let page = 0;
const PAGE_SIZE = 10;
let catAtiva = "";
let termo = "";

const grid = document.getElementById("grid");
const cats = document.getElementById("cats");

function moeda(v){
  return "R$ " + Number(v||0).toLocaleString("pt-BR",{minimumFractionDigits:2});
}

function renderCats(){
  cats.innerHTML = CATS.map(c => `
    <button class="cat ${c.key===catAtiva?'active':''}"
      onclick="setCat('${c.key.replace(/'/g,"\\'")}')">
      ${c.label}
    </button>
  `).join("");
}

function setCat(k){
  catAtiva = k;
  page = 0;
  grid.innerHTML = "";
  renderCats();
  loadMore();
}

function openModal(p){
  mImg.src = p.foto_url || "";
  mName.textContent = p.nome;
  mDesc.textContent = p.descricao || "";
  mPrice.textContent = moeda(p.preco_venda);
  modal.classList.add("open");
}
function closeModal(){ modal.classList.remove("open"); }

async function loadMore(){
  const from = page * PAGE_SIZE;
  const to = from + PAGE_SIZE - 1;

  let q = sb
    .from("buffet")
    .select("id, nome, descricao, preco_venda, foto_url, tipo, ativo")
    .eq("ativo", true)
    .order("created_at", { ascending:false })
    .range(from, to);

  if (catAtiva) q = q.eq("tipo", catAtiva);
  if (termo) q = q.ilike("nome", `%${termo}%`);

  const { data, error } = await q;
  if (error) return console.error(error);

  (data || []).forEach(p => {
    const d = document.createElement("div");
    d.className = "card";
    d.onclick = () => openModal(p);
    d.innerHTML = `
      <img class="thumb" src="${p.foto_url || ""}">
      <div class="body">
        <div class="name">${p.nome}</div>
        <div class="desc">${p.descricao || ""}</div>
        <div class="price">${moeda(p.preco_venda)}</div>
      </div>
    `;
    grid.appendChild(d);
  });

  if ((data || []).length) page++;
}

/* Infinite scroll */
window.addEventListener("scroll", () => {
  if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 600) {
    loadMore();
  }
});

/* Busca */
search.oninput = () => {
  termo = search.value.trim();
  page = 0;
  grid.innerHTML = "";
  loadMore();
};

renderCats();
loadMore();
</script>

</body>
</html>
