<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Ingredientes ‚Ä¢ Excel de Custos</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{
  --bg:#0f172a;
  --grid:#1e293b;
  --card:#020617;
  --text:#e5e7eb;
  --muted:#94a3b8;
  --accent:#22c55e;
  --danger:#ef4444;
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,sans-serif;background:var(--bg);color:var(--text)}

.header{
  display:flex; flex-wrap:wrap; gap:10px;
  align-items:center; padding:12px 16px;
  background:#020617; border-bottom:1px solid var(--grid);
}
.header h1{margin:0;font-size:18px;font-weight:900}

.filter, .search, .btn{
  background:#020617; border:1px solid var(--grid); color:var(--text);
  padding:6px 10px; border-radius:8px; font-weight:700;
}
.btn.primary{border-color:var(--accent); color:#bbf7d0}

.table-wrap{overflow:auto;height:calc(100vh - 64px)}
table{border-collapse:collapse;width:100%;min-width:1100px;font-size:13px}
thead th{position:sticky;top:0;background:#020617;z-index:2}
th,td{border:1px solid var(--grid);padding:8px 10px;white-space:nowrap}
tbody tr:hover{background:#020617}

input, select{
  background:#020617;border:1px solid #1e293b;color:#e5e7eb;
  padding:4px 6px;border-radius:6px;font-weight:700
}
input:focus, select:focus{outline:none;border-color:#22c55e}

.bad{color:#ef4444;font-weight:900}
.good{color:#22c55e;font-weight:900}
.action{cursor:pointer}
</style>
</head>

<body>
<div class="header">
  <h1>üßæ Ingredientes ‚Ä¢ Excel de Custos</h1>
  <input id="busca" class="search" placeholder="Buscar ingrediente...">
  <button class="btn primary" onclick="novoIngrediente()">+ Novo ingrediente</button>
</div>

<div class="table-wrap">
<table id="tabela">
<thead>
<tr>
  <th>Nome</th>
  <th>Unidade</th>
  <th>Custo unit√°rio (R$)</th>
  <th>Rendimento %</th>
  <th>Ativo</th>
  <th>A√ß√µes</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

<script>
const sb = supabase.createClient(
  "https://dxkszikemntfusfyrzos.supabase.co",
  "sb_publishable_NNFvdfSXgOdGGVcSbphbjQ_brC3_9ed"
);

let ingredientes = [];

async function carregar(){
  const { data } = await sb.from("ingredientes").select("*").order("nome");
  ingredientes = data || [];
  render();
}

function render(){
  const tbody = document.querySelector("#tabela tbody");
  tbody.innerHTML = "";

  const busca = (buscaInput.value || "").toLowerCase().trim();

  ingredientes
    .filter(i => !busca || i.nome.toLowerCase().includes(busca))
    .forEach(i=>{
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td><input value="${i.nome||""}" onchange="salvar('${i.id}','nome',this.value)"></td>
        <td>
          <select onchange="salvar('${i.id}','unidade_medida',this.value)">
            ${["KG","G","L","ML","UN"].map(u => 
              `<option ${i.unidade_medida===u?'selected':''}>${u}</option>`
            ).join("")}
          </select>
        </td>
        <td><input type="number" step="0.0001" value="${Number(i.valor||0)}" onchange="salvar('${i.id}','valor',this.value)"></td>
        <td><input type="number" step="0.01" value="${Number(i.rendimento_percentual||100)}" onchange="salvar('${i.id}','rendimento_percentual',this.value)"></td>
        <td>
          <select onchange="salvar('${i.id}','ativo',this.value==='true')">
            <option value="true" ${i.ativo?'selected':''}>Sim</option>
            <option value="false" ${!i.ativo?'selected':''}>N√£o</option>
          </select>
        </td>
        <td>
          <span class="action bad" onclick="excluir('${i.id}')">üóëÔ∏è Excluir</span>
        </td>
      `;
      tbody.appendChild(tr);
    });
}

async function salvar(id, campo, valor){
  const obj = {};
  obj[campo] = valor;
  await sb.from("ingredientes").update(obj).eq("id", id);
}

async function novoIngrediente(){
  const nome = prompt("Nome do ingrediente:");
  if(!nome) return;

  await sb.from("ingredientes").insert({
    nome,
    unidade_medida:"KG",
    valor:0,
    rendimento_percentual:100,
    ativo:true
  });
  carregar();
}

async function excluir(id){
  if(!confirm("Excluir este ingrediente?")) return;
  await sb.from("ingredientes").delete().eq("id", id);
  carregar();
}

const buscaInput = document.getElementById("busca");
buscaInput.oninput = render;

carregar();
</script>
</body>
</html>
